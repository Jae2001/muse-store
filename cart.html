<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>è´­ç‰©è½¦</title>
  <style>
    button {
      margin-left: 5px;
      padding: 2px 6px;
      font-size: 14px;
      cursor: pointer;
    }
    p {
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <h1>ğŸ›’ æ‚¨çš„è´­ç‰©è½¦</h1>
  <div id="cart-list"></div>
  <h2 id="total-price"></h2>
  <button id="clear-cart">ğŸ—‘ï¸ æ¸…ç©ºè´­ç‰©è½¦</button>
  <br />
<a href="checkout.html">
  <button style="font-size:16px; padding:10px 20px; margin-top:10px;">âœ… å‰å¾€ç»“è´¦</button>
</a>

  <br /><br />
  <a href="index.html">â¬…ï¸ è¿”å›å•†åº—</a>

  <script>
    // è¯»å–æœ¬åœ°è´­ç‰©è½¦æ•°æ®
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    // åˆå¹¶é‡å¤å•†å“ï¼Œç»Ÿè®¡æ•°é‡
    function mergeCart(cart) {
      return cart.reduce((acc, item) => {
        const found = acc.find(i => i.name === item.name);
        if (found) {
          found.quantity++;
        } else {
          acc.push({...item, quantity: 1});
        }
        return acc;
      }, []);
    }

    // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
    function renderCart() {
      const mergedCart = mergeCart(cart);
      const cartDiv = document.getElementById("cart-list");
      cartDiv.innerHTML = "";
      let total = 0;

      if (mergedCart.length === 0) {
        cartDiv.innerHTML = "<p>è´­ç‰©è½¦ä¸ºç©º</p>";
        document.getElementById("total-price").textContent = "";
        return;
      }

      mergedCart.forEach(item => {
        cartDiv.innerHTML += `
          <p>
            ${item.name} - RM${item.price.toFixed(2)} x ${item.quantity}
            <button onclick="changeQuantity('${item.name}', -1)">-</button>
            <button onclick="changeQuantity('${item.name}', 1)">+</button>
          </p>
        `;
        total += item.price * item.quantity;
      });

      document.getElementById("total-price").textContent = `æ€»é‡‘é¢ï¼šRM${total.toFixed(2)}`;
    }

    // ä¿®æ”¹æ•°é‡ï¼Œdeltaæ˜¯+1æˆ–-1
    window.changeQuantity = function(name, delta) {
      // æ‰¾åˆ°æ‰€æœ‰åŒåå•†å“ç´¢å¼•
      const indices = [];
      cart.forEach((item, idx) => {
        if (item.name === name) indices.push(idx);
      });

      if (delta > 0) {
        // å¢åŠ ä¸€ä»¶å•†å“ï¼ˆç›´æ¥pushä¸€ä¸ªæ–°çš„å•†å“å¯¹è±¡ï¼‰
        const item = cart[indices[0]];
        cart.push({ name: item.name, price: item.price });
      } else if (delta < 0 && indices.length > 0) {
        // å‡å°‘ä¸€ä»¶å•†å“ï¼ˆåˆ æ‰æœ€å…ˆæ‰¾åˆ°çš„ä¸€ä¸ªï¼‰
        cart.splice(indices[0], 1);
      }
      // æ›´æ–°æœ¬åœ°å­˜å‚¨å’Œé¡µé¢
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    };

    // æ¸…ç©ºè´­ç‰©è½¦æŒ‰é’®
    document.getElementById("clear-cart").onclick = function() {
      cart = [];
      localStorage.removeItem("cart");
      renderCart();
    };

    // é¡µé¢åˆå§‹æ¸²æŸ“
    renderCart();
  </script>
</body>
</html>
